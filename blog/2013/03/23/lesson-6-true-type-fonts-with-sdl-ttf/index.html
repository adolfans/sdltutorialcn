
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>第六节: 使用SDL_ttf绘制True Type字体 - SDL中文教程</title>
  <meta name="author" content="Adolfans">

  
  <meta name="description" content="In this lesson we will start learning how to use the SDL_ttf library to render text using True Type fonts. For this lesson you&#8217;ll need the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://adolfans.github.com/sdltutorialcn/blog/2013/03/23/lesson-6-true-type-fonts-with-sdl-ttf/">
  <link href="/sdltutorialcn/favicon.png" rel="icon">
  <link href="/sdltutorialcn/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/sdltutorialcn/javascripts/modernizr-2.0.js"></script>
  <script src="/sdltutorialcn/javascripts/ender.js"></script>
  <script src="/sdltutorialcn/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/sdltutorialcn/atom.xml" rel="alternate" title="SDL中文教程" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/sdltutorialcn/">SDL中文教程</a></h1>
  
    <h2>_(:3」∠)_目前一团乱还请各位见谅<br>总之各位随意~</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/sdltutorialcn/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:adolfans.github.com/sdltutorialcn" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/sdltutorialcn/">Blog</a></li>
  <li><a href="/sdltutorialcn/blog/archives">Archives</a></li>
  <li><a href="/sdltutorialcn/sdl-2-dot-0-tutorial-index/">SDL2.0教程目录</a></li>
  <li><a href="/sdltutorialcn/about">关于</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">第六节: 使用SDL_ttf绘制True Type字体</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-23T00:54:00+08:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In this lesson we will start learning how to use the SDL_ttf library to render text using True Type fonts. For this lesson you&#8217;ll need the SDL_ttf library which you should have from when you downloaded and compiled all the libraries on SDL2.0 Mercurial. If you don&#8217;t have the SDL2.0 version of SDL_ttf, you should download and compile it now. The library is linked up the same as SDL_image was in Lesson 3.</p>

<p>本节我们将开始学习怎样使用SDL_ttf库来用True type字体绘制文本。本节需要你从Mercurial里预先下载并编译好SDL_ttf库。如果你还没有SDL_ttf的SDL2.0版本，你应该现在下载编译它。这个库和第三节提到的SDL_image的链接方法很相似。</p>

<!-- more -->


<p>In addition to the library we&#8217;ll need a true type font to use to draw our text. It&#8217;s important that you&#8217;re careful when choosing a font as many fonts are proprietary or have rules about using them in software, and if used without the proper licensing can result in a nasty legal mess. Fortunately for us there are many excellent open fonts available online. For this lesson we&#8217;ll be using a set of open source fonts recently released by Adobe which you can download directly from sourceforge, the specific font I chose for this lesson is SourceSansPro-Regular, but you can use any font you like.</p>

<p>除了这个库之外，我们还需要一个true type字体来绘制文本。需要强调的是你在选择字体的时候要小心，因为很多字体是专有的或者是需要你在使用过程中遵循一定规范。如果未经许可使用，可能会导致一些令人讨厌的法律问题。不过幸运的是，网上仍然有很多优秀又开放的字体。本节我们使用一套最近由Adobe发布的开源字体，你可以从sourceforge上下载到。本节我选用的字体是SourceSansPro-Regular，你可以选任意你喜欢的字体。</p>

<p>Now that we&#8217;ve got our font downloaded and libraries linked up lets take a look at how we can work with fonts via SDL_ttf. The library provides functionality for opening and closing TTF fonts and rendering text to SDL_Surface pointers. The library also lets us specify the color and font size we&#8217;d like to use when rendering the text. You can find the full library documentation here.</p>

<p>既然我们已经下载了字体并链接好了库文件，我们看一下怎样通过SDL_ttf来使用字体。这个库提供了打开和关闭TTF字体与把文本会知道SDL_Surface指针上的功能。这个库还让我们指定绘制文本时的字体和颜色。你可以从这里找到库的文档全文。</p>

<p>首先，我们需要包含SDL_ttf.h头文件。</p>

<div><script src='https://gist.github.com/3390025.js?file=1.cpp'></script>
<noscript><pre><code>#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDL_ttf.h&gt;
#include &lt;stdexcept&gt;
#include &lt;string&gt;
#include &lt;iostream&gt;</code></pre></noscript></div>


<p>In order to use the library we need to initialize it in our main function after initializing SDL. Note that we check for errors similar to how we check for issues when starting SDL, except that now to get the appropriate error information we use TTF_GetError, similar to what we did in Lesson 3 to get SDL_image error information.</p>

<p>为了使用这个库，我们需要在main函数中，初始化SDL完毕后，初始化SDL_ttf库。注意我们在检查错误的时候，使用的方法和检查初始化SDL时问题的方法一样，除了用的是TTF_GetError来获取适当的错误信息之外，和第三节中获取SDL_image的错误信息的方法类似。</p>

<div><script src='https://gist.github.com/3390025.js?file=2.cpp'></script>
<noscript><pre><code>if (TTF_Init() == -1){
    std::cout &lt;&lt; TTF_GetError() &lt;&lt; std::endl;
    return 2;
}</code></pre></noscript></div>


<p>Next we&#8217;ll want to make a function to render a message and abstract away the work that goes into it, and simply return an SDL_Texture that we can draw to the screen. In addition to rendering the message the function will also need to convert the SDL_Surface pointer returned from TTF_RenderText_X to a SDL_Texture pointer and return that.</p>

<p>下一步我们要编写一个绘制一行消息的函数并把它所做的工作抽象出来，然后单纯地返回一个我们可以直接绘制到屏幕上的SDL_Texture。除了把消息的文字绘制出来之外，这个函数还需要把TTF_RenderText_X返回的SDL_Surface指针转化为SDL_Texture指针，并将之返回。</p>

<p>The information needed to render the message is the message itself, a font file name, a font size and a font color. We can now add a nice function to render our desired message to our code:</p>

<p>需要的信息包括需要绘制的消息，一个字体文件名，字体大小以及字体颜色。我们现在可以给我们的代码中添加一个可以绘制我们想要消息的美好的函数了：</p>

<div><script src='https://gist.github.com/3390025.js?file=3.cpp'></script>
<noscript><pre><code>SDL_Texture* RenderText(std::string message, std::string fontFile, 
                        SDL_Color color, int fontSize)
{
    //Open the font
    TTF_Font *font = nullptr;
    font = TTF_OpenFont(fontFile.c_str(), fontSize);
    if (font == nullptr)
        throw std::runtime_error(&quot;Failed to load font: &quot; + fontFile + TTF_GetError());
    
    //Render the message to an SDL_Surface, as that's what TTF_RenderText_X returns
    SDL_Surface *surf = TTF_RenderText_Blended(font, message.c_str(), color);
    SDL_Texture *texture = SDL_CreateTextureFromSurface(renderer, surf);
    //Clean up unneeded stuff
    SDL_FreeSurface(surf);
    TTF_CloseFont(font);

    return texture;
}</code></pre></noscript></div>


<p>That&#8217;s quite a bit of code! Lets step through it and figure out exactly what&#8217;s going on. First, we know that we need a message, font file, font color and font size so that we can properly draw our message. SDL provides the SDL_Color structure that is used for specifying what color we want and takes three values for RGB which can each range from 0-255.</p>

<p>这些代码真是相当地不少！让我们把它看一遍，看看它实际上在做什么。首先，我们知道我们需要一条消息，字体文件，字体颜色还有字体大小，以便于正确地绘制消息。SDL提供了SDL_Color结构来指定我们想要的颜色，它包含三个分别对应RGB的值，其中每个的取值范围为0-255.</p>

<p>The first step in drawing the text is to open our font, which we do on line 4 using TTF_OpenFont, which takes the font file and the font size to open the font as. Note that the same nullptr error checking that we&#8217;ve used before in LoadImage is used to make sure the font opened ok. If it fails we throw an error and include the font file name that caused the error along with TTF_GetError so that we can have enough information to diagnose the issue.</p>

<p>绘制文本的第一步是打开这个字体，代码中第四行我们使用了TTF_OpenFont这个函数，它需要一个字体文件名与字体大小以打开字体。注意之前的LoadImage函数中使用的检查空指针的错误检测方法在这里也可以用于确认字体被正确地打开。如果打开失败，我们抛出一个错误，其中包括导致这个错误的字体文件的名称，以及TTF_GetError获得的错误，以便之后我们拥有足够的错误信息来解决这个问题。</p>

<p>If the font loaded ok we use TTF_RenderText_Blended to write the message to an SDL_Surface and get the pointer back. There are a few methods provided by SDL_ttf for rendering text, blended is the slowest but provides a nice smooth look. The other methods can be found in the documentation linked above.</p>

<p>如果字体加载正确了，我们使用TTF_RenderTextBlended函数，将消息文本写入SDL_Surface上，并且获取这个SDL_Surface指针。SDL_ttf提供了几种方法来绘制文本，blended是其中绘制效率最慢但是效果看起来最好的。其他的方法可以从文档中查找到。</p>

<p>However because we use SDL_Textures in our rendering we need to convert the surface over. This isn&#8217;t too difficult because we&#8217;ve made our SDL_Renderer a global and so it&#8217;s easy to pass it into the function SDL_CreateTextureFromSurface. After creating the SDL_Texture we need to clean up things we no longer need to keep in memory, the SDL_Surface and the TTF_Font. We free the surface the same as before and can use TTF_CloseFont to close the font we opened.</p>

<p>但是，因为在绘制过程中我们使用的是SDL_Texture，所以我们需要把surface转换为SDL_Texture. 这并不难，因为我们把SDL_Renderer设为了全局变量，所以把它直接传入SDL_CreateTextureFromSurface很容易。在创建完SDL_Texture之后，我们需要把不用的变量，SDL_Surface和TTF_Font的变量清理掉。我们和以前一样释放掉surface，使用TTF_CloseFont关闭掉我们打开的字体。</p>

<p>Once everything is cleaned up we return the SDL_Texture pointer for usage in the program.</p>

<p>当所有的东西被清理完毕后，我们返回SDL_Texture指针。</p>

<p>When we want to render some text in our program we can now perform a call like so:</p>

<p>当我们想要绘制一些文本的时候，我们可以执行如下这段代码：</p>

<div><script src='https://gist.github.com/3390025.js?file=4.cpp'></script>
<noscript><pre><code>SDL_Texture *image = nullptr;
try {
    SDL_Color color = { 255, 255, 255 };
    image = RenderText(&quot;TTF fonts are cool!&quot;, &quot;../res/Lesson6/SourceSansPro-Regular.ttf&quot;, 
        color, 64);
}
catch (const std::runtime_error &amp;e){
    std::cout &lt;&lt; e.what() &lt;&lt; std::endl;
    return 4;
}</code></pre></noscript></div>


<p>Here we render the message &#8220;TTF fonts are cool!&#8221; using the font we downloaded above in white with a font size of 64.</p>

<p>这里我们把消息“TTF fonts are cool!”使用之前下载的那个字体绘制了出来，大小为64。</p>

<p>You can then treat the texture as any other texture and draw it the same as we&#8217;ve done previously with our ApplySurface function. If you draw the message centered, you should see something like this when you run the program:</p>

<p>然后你可以把这个texture当作一般的texture，使用和以前一样的ApplySurface函数绘制出来。如果你将消息文本以居中的形式绘制了，你应该可以看到以下结果：</p>

<p><img src="/sdltutorialcn/images/blogimages/lesson6/ttf_result.png"></p>

<p>Try playing around with the other TTF_RenderText_X functions and see how they look!</p>

<p>试着玩玩其他的那些TTF_RenderText_X函数吧，看看它们的效果是什么样的！</p>

<p>End of Lesson 6
Thanks for joining me! I&#8217;ll see you again soon in Lesson 7: Taking Advantage of Classes.</p>

<p>第六节结束</p>

<p>感谢你的加入！我们第七节：充分利用类再见！</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Adolfans</span></span>

      








  


<time datetime="2013-03-23T00:54:00+08:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/sdltutorialcn/blog/2013/02/14/lesson-5-clipping-sprite-sheets/" title="Previous Post: SDL2.0教程翻译·第五节：裁剪精灵表">&laquo; SDL2.0教程翻译·第五节：裁剪精灵表</a>
      
      
        <a class="basic-alignment right" href="/sdltutorialcn/blog/2013/03/24/lesson-7-taking-advantage-of-classes/" title="Next Post: 第七节：充分利用类">第七节：充分利用类 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/sdltutorialcn/blog/2013/03/24/lesson-8-timers/">第八节：计时器</a>
      </li>
    
      <li class="post">
        <a href="/sdltutorialcn/blog/2013/03/24/lesson-7-taking-advantage-of-classes/">第七节：充分利用类</a>
      </li>
    
      <li class="post">
        <a href="/sdltutorialcn/blog/2013/03/23/lesson-6-true-type-fonts-with-sdl-ttf/">第六节: 使用SDL_ttf绘制True Type字体</a>
      </li>
    
      <li class="post">
        <a href="/sdltutorialcn/blog/2013/02/14/lesson-5-clipping-sprite-sheets/">SDL2.0教程翻译·第五节：裁剪精灵表</a>
      </li>
    
      <li class="post">
        <a href="/sdltutorialcn/blog/2013/02/12/lesson-4-event-driven-programming/">第四节：事件驱动的编程</a>
      </li>
    
  </ul>
</section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/117151825287907703585?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Adolfans -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sdltutorialcn';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://adolfans.github.com/sdltutorialcn/blog/2013/03/23/lesson-6-true-type-fonts-with-sdl-ttf/';
        var disqus_url = 'http://adolfans.github.com/sdltutorialcn/blog/2013/03/23/lesson-6-true-type-fonts-with-sdl-ttf/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
